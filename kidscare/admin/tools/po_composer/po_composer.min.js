jQuery(document).ready(function(){po_composer_check_visibility();jQuery(".po_composer select,.po_composer textarea").change(function(){po_composer_check_visibility()});jQuery("#po_save").click(function(){jQuery("#po_composer_form").get(0).submit()});jQuery("#po_text").change(function(){jQuery(".po_composer_links").hide()});jQuery(".po_composer_editor").tabs({beforeActivate:function(a,b){if(b.newTab.attr("id")=="po_composer_link_text"){po_composer_update_text();jQuery("#po_save").show()}else{po_composer_parse_text();po_composer_update_list();jQuery("#po_save").hide()}},activate:function(a,b){if(b.newTab.attr("id")=="po_composer_link_text"){jQuery("#po_text").get(0).focus()}else{jQuery("#po_string").get(0).focus();jQuery("#po_string").select()}}});jQuery(".po_composer #po_list").change(function(){var a=jQuery(this).val().split(",");var b=po_composer_get_string(po_composer_list[a[0]]["msgstr"][a[1]]);if(b==""){b=po_composer_get_string(po_composer_list[a[0]]["msgid"][a[1]])}jQuery("#po_string").data("idx",jQuery(this).val()).val(b).get(0).focus();jQuery("#po_string").select();jQuery("#po_msgid").html(po_composer_get_string(po_composer_list[a[0]]["msgid"][a[1]]))});jQuery(".po_composer #po_string").keydown(function(f){if(f.which==38||f.which==40||f.which==13){var a=jQuery(this).data("idx").split(",");var g=jQuery(this).val();if(g==po_composer_get_string(po_composer_list[a[0]]["msgid"][a[1]])){g=""}jQuery("#list_"+a[0]+"_"+a[1]).toggleClass("translated",g!="");if(po_composer_get_string(po_composer_list[a[0]]["msgstr"][a[1]])!=g){jQuery("#list_"+a[0]+"_"+a[1]).html(po_composer_get_html(g==""?po_composer_get_string(po_composer_list[a[0]]["msgid"][a[1]]):g));jQuery(".po_composer_links").hide()}po_composer_list[a[0]]["msgstr"][a[1]]=(a[1]==0?"msgstr ":"")+'"'+po_composer_addslashes(g)+'"';var b=f.which==38?-1:1;var d=jQuery("#po_list").eq(0);var c=d.get(0).selectedIndex+b;if(c>=0&&c<d.get(0).options.length){d.get(0).selectedIndex=c;d.trigger("change");f.preventDefault();return false}}})});function po_composer_check_visibility(){var c=jQuery(".po_composer");var d=c.find("#po_src").val();if(d=="upload_"){c.find("#po_file").show()}else{c.find("#po_file").hide()}var b=c.find("#po_src2").val();if(b=="upload_"){c.find("#po_file2").show()}else{c.find("#po_file2").hide()}var a="Update";if(b!=""){a="Merge"}else{if(d=="upload_"){a="Upload"}else{if(d!="edit_"&&c.find("#po_text").val()==""){a="Load"}}}c.find("#po_save").html(a)}var po_composer_list=[];function po_composer_parse_text(){po_composer_list=[];var g=jQuery("#po_text").val();if(g==""){return false}var e=g.split("\n");po_composer_list=[{comments:[],msgid:[],msgstr:[]}];var d="";var a=0;var f="";for(var b=0;b<e.length;b++){var c=e[b];while(c.length>0&&" \r\n\t".indexOf(c.charAt(c.length-1))>=0){c=c.substring(0,c.length-1)}if(c!=""){if(c.charAt(0)=="#"){if(d==""){a++;po_composer_list[a]={comments:[],msgid:[],msgstr:[]}}po_composer_list[a]["comments"].push(c)}else{if(c.substr(0,5)=="msgid"){po_composer_list[a]["msgid"].push(c);f="msgid"}else{if(c.substr(0,6)=="msgstr"){po_composer_list[a]["msgstr"].push(c);f="msgstr"}else{if(c.charAt(0)=='"'){po_composer_list[a][f].push(c)}}}}}d=c}}function po_composer_update_list(){var e="";for(var d=0;d<po_composer_list.length;d++){var a=po_composer_list[d];if(a.msgid.length>0){for(var b=0;b<a.msgid.length;b++){if(po_composer_get_string(a.msgid[b])==""){break}var c=po_composer_get_string(po_composer_get_html(a.msgstr[b]));e+='\n<option id="list_'+d+"_"+b+'" value="'+d+","+b+'"'+(a.msgstr[b]=='""'||a.msgstr[b]=='msgstr ""'?"":' class="translated"')+">"+(c?c:po_composer_get_string(po_composer_get_html(a.msgid[b])))+"</option>"}}}jQuery("#po_list").html(e);jQuery("#po_list").get(0).selectedIndex=0;jQuery("#po_list").trigger("change")}function po_composer_update_text(){var d="";for(var c=0;c<po_composer_list.length;c++){var a=po_composer_list[c];if(a.comments.length>0){for(var b=0;b<a.comments.length;b++){d+=a.comments[b]+"\n"}}if(a.msgid.length>0){for(var b=0;b<a.msgid.length;b++){d+=a.msgid[b]+"\n"}}if(a.msgstr.length>0){for(var b=0;b<a.msgstr.length;b++){d+=a.msgstr[b]+"\n"}}d+="\n"}jQuery("#po_text").val(d).trigger("change")}function po_composer_get_string(b){var c=b.indexOf('"');var a=b.lastIndexOf('"');if(c>=0&&a>c){b=po_composer_stripslashes(b.substr(c+1,a-c-1))}else{b=""}return b}function po_composer_get_html(a){var c=document.createElement("div");var b=document.createTextNode(a);c.appendChild(b);return c.innerHTML}function po_composer_stripslashes(b){var c=b.indexOf("\\");while(c>=0){var a=b.charAt(c+1);b=b.substring(0,c)+b.substring(c+1);c=b.indexOf("\\",c+1)}return b}function po_composer_addslashes(c){var a=0;while(a<c.length){var b=c.charAt(a);if("\"'\\".indexOf(b)>=0){c=c.substring(0,a)+"\\"+c.substring(a);a++}a++}return c};