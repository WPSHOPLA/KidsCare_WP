var THEMEREX_user_marks=false;jQuery(document).ready(function(){jQuery(".ratingEdit").mousemove(function(c){if(typeof(allowUserReviews)=="undefined"||!allowUserReviews){return}var b=jQuery(this).width();var a=c.pageX-jQuery(this).offset().left;if(a==1){a=0}if(a<=b){var d=Math.round(a/b*100);jQuery(this).find(".ratBubble").css("left",d+"%").html(marksToDisplay(d)+(reviews_max_level==100?"%":""))}});jQuery(".ratingEdit").click(function(c){if(typeof(allowUserReviews)=="undefined"||!allowUserReviews){return}var b=jQuery(this).width();var a=c.pageX-jQuery(this).offset().left;if(a==1){a=0}if(a<=b){var d=Math.round(a/b*100);jQuery(this).data("mark",marksToDisplay(d)).find("input").val(marksToDisplay(d)).end().find(".starHover").css("width",d+"%");if(!THEMEREX_ADMIN_MODE&&!THEMEREX_user_marks){THEMEREX_user_marks=true;jQuery(this).parent().siblings(".ratBody").find(".ratingEdit").each(function(){jQuery(this).data("mark",0).find(".starHover").css("width",0);jQuery(this).find("input").val("")})}setAverageMark(jQuery(this).parents(".ratingStars"))}});if(typeof(allowUserReviews)!="undefined"&&allowUserReviews){jQuery("#users-tabs .accept a").click(function(a){var b=0;var c=0;jQuery("#users-tabs .ratingEdit input").each(function(d){var e=parseFloat(jQuery(this).val());if(isNaN(e)){e=0}marks[d]=Math.round(((marks.length>d&&marks[d]!=""?parseFloat(marks[d])*users:0)+e)/(users+1)*10)/10;jQuery(this).val(marks[d]);b++;c+=e});if(c>0){if(marks.length>b){marks=marks.splice(b,marks.length-b)}users++;jQuery("#users-tabs .accept").fadeOut();jQuery.post(THEMEREX_ajax_url,{action:"reviews_users_accept",nonce:THEMEREX_ajax_nonce,post_id:post_id,marks:marks.join(","),users:users}).done(function(d){var e=JSON.parse(d);if(e.error===""){allowUserReviews=false;jQuery.cookie("reviews_vote",reviews_vote+(reviews_vote.substr(-1)!=","?",":"")+post_id+",",{expires:365,path:"/"});jQuery("#users-tabs .ratingItem").each(function(f){jQuery(this).data("mark",marks[f]).find("input").val(marks[f]).end().find(".starHover").css("width",Math.round(marks[f]/reviews_max_level*100)+"%")});setAverageMark(jQuery("#users-tabs"));jQuery("#users-tabs .ratingEdit").removeClass("ratingEdit");jQuery("#users-tabs .infoTotal .infoRat").html(THEMEREX_REVIEWS_VOTE)}else{jQuery("#users-tabs .infoTotal .infoRat").html(THEMEREX_REVIEWS_ERROR)}})}a.preventDefault();return false})}});function setAverageMark(c){var b=0;var a=0;c.find(".ratingEdit").each(function(){b+=parseFloat(jQuery(this).data("mark"));a++});b=a>0?Math.round(b/a*10)/10:"0";if(reviews_max_level<100&&String(b).indexOf(".")<0){b+=".0"}c.find(".infoTotal").find(".totalRating").html(b).end().find(".ratingItem").data("mark",b).find(".starHover").css("width",Math.round(b/reviews_max_level*100)+"%")}function marksToDisplay(a){if(reviews_max_level<100){a=Math.round(a/100*reviews_max_level*10)/10;if(String(a).indexOf(".")<0){a+=".0"}}return a}function getReviewsRatingWordValue(b){var c=reviews_levels.split(",");var a=reviews_max_level/c.length;b=Math.max(0,Math.min(c.length-1,Math.floor(b/a)));return c[b]};